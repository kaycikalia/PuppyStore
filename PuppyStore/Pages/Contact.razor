@page "/contact"
@using System.ComponentModel.DataAnnotations
@using PuppyStore.Shared.Models
@inject HttpClient Http

<div class="contact-page">
    <div class="contact-wrapper">

        <div class="contact-box">
            <h1>Contact Puppy Love 🐾</h1>
            <p class="subtitle">We'd love to hear from you!</p>

            <div class="contact-info">
                <div class="info-item">
                    <span class="icon">📍</span>
                    <span>15030 SE 46th St. Nampa, Idaho</span>
                </div>
                <div class="info-item">
                    <span class="icon">📞</span>
                    <a href="tel:4253514890">(425) 351-4890</a>
                </div>
                <div class="info-item">
                    <span class="icon">📧</span>
                    <a href="mailto:kaycikalia@gmail.com">kaycikalia@gmail.com</a>
                </div>
                <div class="info-item">
                    <span class="icon">🕒</span>
                    <span>Mon–Sat 10:00 AM – 6:00 PM</span>
                </div>
            </div>
        </div>

        <div class="contact-box">
            <h2>Send Us a Direct Message 💌</h2>

            <EditForm Model="@form" OnValidSubmit="HandleSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="form-group">
                    <label>Name</label>
                    <InputText class="form-input" @bind-Value="form.Name" placeholder="Your name" />
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <InputText class="form-input" @bind-Value="form.Email" placeholder="Your email" />
                </div>

                <div class="form-group">
                    <label>Message</label>
                    <InputTextArea class="form-textarea" @bind-Value="form.Message" placeholder="Write your message here..." />
                </div>

                <button class="btn-primary" type="submit" disabled="@sending">
                    @(sending ? "Sending..." : "Send Message")
                </button>

                @if (sent)
                {
                    <p class="success">✅ Your message has been sent. Thank you!</p>
                }

                @if (!string.IsNullOrEmpty(error))
                {
                    <p class="error">❌ @error</p>
                }
            </EditForm>
        </div>
    </div>
</div>

<style>
    .contact-page {
        min-height: 100vh;
        padding: clamp(12px, 3vw, 20px);
        box-sizing: border-box;
    }

    .contact-wrapper {
        display: flex;
        flex-direction: column;
        gap: clamp(16px, 3vw, 24px);
        max-width: 800px;
        margin: 0 auto;
        padding: clamp(0px, 2vw, 10px);
    }

    .contact-box {
        width: 100%;
        padding: clamp(16px, 4vw, 30px);
        border-radius: clamp(10px, 2vw, 12px);
        background: #FFE6EB;
        border: clamp(2px, 0.5vw, 3px) solid #FFB6C1;
        color: #D12978;
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        box-sizing: border-box;
    }

        .contact-box h1 {
            text-align: center;
            font-weight: bold;
            color: #D12978;
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin: 0 0 8px 0;
        }

        .contact-box h2 {
            text-align: center;
            font-weight: bold;
            color: #D12978;
            font-size: clamp(1.25rem, 4vw, 1.5rem);
            margin: 0 0 20px 0;
        }

    .subtitle {
        text-align: center;
        font-weight: 600;
        margin-bottom: 20px;
        font-size: clamp(0.9rem, 3vw, 1rem);
    }

    .contact-info {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .info-item {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        font-size: clamp(0.85rem, 3vw, 1rem);
        word-break: break-word;
    }

        .info-item .icon {
            flex-shrink: 0;
            font-size: 1.1rem;
        }

        .info-item a {
            color: #D12978;
            text-decoration: underline;
            word-break: break-all;
        }

    .form-group {
        margin-bottom: clamp(12px, 2vw, 16px);
    }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }

    .form-input,
    .form-textarea {
        padding: clamp(10px, 2vw, 12px);
        border-radius: 8px;
        border: 2px solid #FFB6C1;
        width: 100%;
        background: #FFFFFF;
        color: #D12978;
        font-size: 16px;
        box-sizing: border-box;
    }

        .form-input:focus,
        .form-textarea:focus {
            border-color: #D12978;
            outline: none;
            background: #FFFFFF;
        }

    .form-textarea {
        resize: vertical;
        min-height: 120px;
    }

    .btn-primary {
        background-color: #D12978;
        padding: clamp(12px, 2vw, 14px) 20px;
        font-size: clamp(1rem, 3vw, 1.125rem);
        border-radius: 10px;
        border: none;
        color: white;
        cursor: pointer;
        width: 100%;
        transition: 0.2s ease-in-out;
        margin-top: 8px;
    }

        .btn-primary:hover {
            background-color: #C94C72;
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

    .success {
        color: #2e7d32;
        margin-top: 12px;
        font-weight: bold;
        text-align: center;
        font-size: clamp(0.85rem, 3vw, 1rem);
    }

    .error {
        color: #b00020;
        margin-top: 12px;
        font-weight: bold;
        text-align: center;
        font-size: clamp(0.85rem, 3vw, 1rem);
    }

    .validation-message {
        color: #b00020;
        font-size: 0.85rem;
        margin-top: 4px;
    }
</style>

@code {
    private ContactFormModel form = new();
    private bool sent;
    private bool sending;
    private string? error;

    private async Task HandleSubmit()
    {
        sent = false;
        error = null;
        sending = true;

        try
        {
            var dto = new ContactForm
            {
                Name = form.Name,
                Email = form.Email,
                Message = form.Message
            };

            var response = await Http.PostAsJsonAsync("api/contact/send", dto);

            if (response.IsSuccessStatusCode)
            {
                sent = true;
                form = new();
            }
            else
            {
                error = "Sorry, something went wrong while sending your message.";
            }
        }
        catch
        {
            error = "Sorry, something went wrong while sending your message.";
        }
        finally
        {
            sending = false;
        }
    }

    public sealed class ContactFormModel
    {
        [Required] public string Name { get; set; } = "";
        [Required, EmailAddress] public string Email { get; set; } = "";
        [Required] public string Message { get; set; } = "";
    }
}